% !TEX TS-program = XeLaTeX

\documentclass{article}
\usepackage{fontspec,fancyvrb,geometry,graphicx,calc,multicol,grffile}
\geometry{margin=2cm,a4paper}
\raggedbottom

\setmainfont[Ligatures=TeX]{texgyrepagella-regular.otf}
\setmonofont{Inconsolata}


\newcommand\meta[1]{$\langle$\emph{#1}$\rangle$}

\newcommand\TEST[1]{%
  \newpage
  \section{Test `#1.ltx'}
  \begin{minipage}{0.45\textwidth}
    \fboxsep=1pt
    \fboxrule=1pt
    \fbox{\insertpdf#1\END}
  \end{minipage}\hfill
  \begin{minipage}{0.45\textwidth}
    \fboxsep=1pt
    \fboxrule=1pt
    \fbox{\insertsafepdf#1\END}
  \end{minipage}
  \VerbatimInput{tests/#1.ltx}
}

\def\insertpdf#1#2\END{%
  \includegraphics[width=\linewidth]{build/#1#2.pdf}%
}
\def\insertsafepdf#1#2\END{%
  \includegraphics[width=\linewidth]{tests/#1#2.Xsafe.pdf}%
}

\newcommand\codeline[1]{\par{\centering#1\par}\par\noindent\ignorespaces}

\pagestyle{empty}
\begin{document}
\title{The \textsf{fontspec} test suite}
\author{Will Robertson}
\date{Compiled: \today}
\maketitle
\thispagestyle{empty}

\section*{Preamble}

The examples shown in the remainder of the document are generated directly from the code shown alongside.
As well as being good minimal examples, these tests are useful to ensure that changes to \textsf{fontspec} don't affect old behaviour.

Output shown on the left is compiled with the current version of \textsf{fontspec}; the output on the right indicates the intended output when the test was first compiled.

\input{build/testsuite-listing.tex}

\end{document}